<html>
<head>
	<title></title>
	<link href="document.css" rel="stylesheet" type="text/css" />
</head>
<body></body>
</html>
<html>
<head>
	<title></title>
	<link href="document.css" rel="stylesheet" type="text/css" />
</head>
<body></body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<title></title>
	<link href="document.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h1>Roaster Client Support</h1>

<p>Roaster is designed to support single-page applications. To this end it provides:</p>

<ul>
	<li>Framework for compiling to browser supported formats. Out of the box Coffeescript to Javascript and Less to CSS are available.</li>
	<li>Package management and load-on-demand support for project and third-party code. Many prepared packages such as those for jquery, ckeditor and codemirror.</li>
	<li>A very very lightweight solution for separation of concerns providing the value of MVC without the overheads in both understanding and code.</li>
	<li>Simplified single-script installation for roaster and any system built with it. Works with OS-X, Linux and Windows.</li>
	<li>Common module support for sharing code between Node and the browser.</li>
</ul>

<p><textarea readonly="readonly" source="true" type="gwt.coffee">browser = gwt.browser()
gwt.open_page = (path = 'test/index.html') -&gt; gwt.preactions.push -&gt;
  url = "http://localhost:9011/#{path}"
  @page = browser.page('live').open url, retain: true
  @page.once 'open', =&gt; @next()
  @page.once 'error', =&gt; @fail()</textarea></p>

<div class="metadata Ref"> </div>

<h2>Initialisation</h2>

<p>Every project starts at <em>/index.html</em>. For a 'standard' roaster based project this is an empty document that loads&nbsp;/client/bootstrap.coffee to start the heavy lifting. This script initialises a requires keyword anc calls another roaster specific script <em>/client/bootstrap/init.coffee</em>. All if this is just preparation. A project specific <em>/client/app.coffee</em>&nbsp;prepares the application and loads the screen.</p>

<div class="metadata Ref">Ref: <span class="tab_view"><a href="javascript:usdlc.edit_source({value:'tab_view.html',path:'../roaster/client/integrants/tab_view.html',category:'integrants'})">tab_view.html</a> </span></div>

<h2>Script and CSS Pre-compilation</h2>

<h2>Support</h2>

<h3>Page Arguments</h3>

<p>Page arguments provide controlled application operation from either the html or the search part of the url.</p>

<pre title="html" type="html">
&lt;!DOCTYPE HTML&gt;
  
    roaster = {opts: {'test-arg': 23}}
  &lt;/script&gt;
  &lt;script src='/client/bootstrap.coffee?domain=client,library'&gt;
  &lt;/script&gt;
&lt;/head&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<p> </p>

<pre title="coffee" type="coffee">
gwt.open_page "gen/usdlc2/Roaster_Client_Support/"+
              "Support/Page_Arguments.html?test-arg2=45"
  
gwt.add "Embedded Page Arguments", -&gt; @page.test -&gt;
  usdlc2.check roaster.page_arg('test-arg'), '23'
  
gwt.add "Address Page Arguments", -&gt; @page.test -&gt;
  usdlc2.check roaster.page_arg('test-arg2'), '45'
  
gwt.add "Default Page Arguments", -&gt; @page.test -&gt;
  usdlc2.check roaster.page_arg('unknown', '12'), '12'</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span><span class="index"><a href="javascript:usdlc.edit_source({value:'index.html',path:'../roaster/index.html',category:'roaster'})">index.html</a> </span><span class="bootstrap"><a href="javascript:usdlc.edit_source({value:'bootstrap.coffee',path:'../roaster/client/bootstrap.coffee',category:'client'})">bootstrap.coffee</a> </span><span class="create-http-server"><a href="javascript:usdlc.edit_source({value:'create-http-server.coffee',path:'../roaster/server/boot/create-http-server.coffee',category:'boot'})">create-http-server.coffee</a> </span><span class="less"><a href="javascript:usdlc.edit_source({value:'less.coffee',path:'../roaster/drivers/less.coffee',category:'drivers'})">less.coffee</a> </span><span class="server"><a href="javascript:usdlc.edit_source({value:'server.coffee',path:'../roaster/server/boot/server.coffee',category:'boot'})">server.coffee</a> </span><span class="internet"><a href="javascript:usdlc.edit_source({value:'internet.coffee',path:'../roaster/server/internet.coffee',category:'server'})">internet.coffee</a> </span><span class="system"><a href="javascript:usdlc.edit_source({value:'system.coffee',path:'../roaster/server/system.coffee',category:'server'})">system.coffee</a> </span><span class="processes"><a href="javascript:usdlc.edit_source({value:'processes.coffee',path:'../roaster/server/processes.coffee',category:'server'})">processes.coffee</a> </span><span class="init"><a href="javascript:usdlc.edit_source({value:'init.coffee',path:'../roaster/client/bootstrap/init.coffee',category:'bootstrap'})">init.coffee</a> </span><span class="mvc"><a href="javascript:usdlc.edit_source({value:'mvc.coffee',path:'../roaster/client/bootstrap/mvc.coffee',category:'bootstrap'})">mvc.coffee</a> </span><span class="driver"><a href="javascript:usdlc.edit_source({value:'driver.coffee',path:'../roaster/server/http/driver.coffee',category:'http'})">driver.coffee</a> </span><span class="respond"><a href="javascript:usdlc.edit_source({value:'respond.coffee',path:'../roaster/server/http/respond.coffee',category:'http'})">respond.coffee</a> </span><span class="sessions"><a href="javascript:usdlc.edit_source({value:'sessions.coffee',path:'../roaster/server/boot/sessions.coffee',category:'boot'})">sessions.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h3>Important Elements</h3>

<p>Roaster keeps a reference to the head element in <em>roaster.head</em>. This is used for adding script and style elements to the document.</p>

<pre title="coffee" type="coffee">
gwt.open_page "index.html"

gwt.add "Header Element", -&gt; @page.test -&gt;
  usdlc2.check roaster.head.nodeName, 'HEAD'</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h2>Sessions</h2>

<h3>Cookies</h3>

<p>Roaster provides a primative to set and/or get cookies from the browser conversation.</p>

<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;"><code>cookies = require 'http:/cookies'<br />
<br />
module.exports = (exchange) -&gt;<br />
&nbsp;&nbsp;my_name = cookies.get exchange.request, 'my_name'<br />
&nbsp;&nbsp;if my_name.length is 0<br />
&nbsp; &nbsp; my_name = 'Donald'<br />
&nbsp;&nbsp; &nbsp;cookies.set exchange.response, my_name: my_name</code><br />
 </div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<div class="metadata Ref">Ref: <span class="sessions"><a href="javascript:usdlc.edit_source({value:'sessions.coffee',path:'../roaster/server/boot/sessions.coffee',category:'boot'})">sessions.coffee</a> </span></div>

<h3>Sessions</h3>

<p>It is all very well for browser conversations to be completely stateless - most of the time. It does make sense, however, that when you log in that the server provides related state. Whenever roaster starts a conversation with a browser it adds a browser session cookie referencing a server side session object. In short, in any interaction, exchange.session can be used to store conversation data - until either the browser or server closes.</p>

<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;"><code>module.exports = (exchange) -&gt;<br />
&nbsp;&nbsp;exchange.session.counter ?= 0<br />
&nbsp;&nbsp;exchange.session.counter += 1<br />
&nbsp;&nbsp;exchange.respond.json counter: exchange.session.counter</code></div>

<h2>Package Management</h2>

<h3>Requires</h3>

<p>Roaster provides an extended version of the CommonJS approach to modules and package management. To support client/server common code and library code, the global require function can take a single module name and return a reference to the code.</p>

<pre title="coffee" type="coffee">
gwt.open_page "index.html"

gwt.add -&gt;
  console.log "#2 CommonJS Requires"
  @page.test -&gt;
    util = require('util')
    usdlc2.test(util.isDate(new Date()))</pre>

<p>The downside is that if the module must be loaded from the server, a synchronous call will be needed - and will freeze the browser until completed. Given that most loads happen when accessing new functionality, and that roaster is designed for local network or same machine use, &nbsp;these freezes are both short and happen at a time when it should not be an annoyance.</p>

<p>In practice module loading should be asynchronous. Roaster supports load-on-demand and asynchronous loading will improve the user experience. Any call to require with multiple parameters will expect the last to be a callback. The other arguments are comma separated lists of modules. The callback returns a single argument being an object with members for each module loaded.</p>

<pre title="coffee" type="coffee">
gwt.add -&gt;
  console.log "#2 Asynchronous Requires"
  @page.test -&gt;
    require "util,strings", "faye", (a) -&gt;
      try
        csv = a.strings.csv.split("1,3", "2,4")
        if not a.util.isArray([1,2])
          return usdlc2.fail("isArray")
        console.log csv
        if (csv.length isnt 4 or
        csv[0] isnt "1" or csv[1] isnt "3" or
        csv[2] isnt "2" or csv[3] isnt "4")
          return usdlc2.fail("csv")
        if typeof(a.faye) isnt "function"
          return usdlc2.fail("faye")
        usdlc2.pass()
      catch e
        usdlc2.fail(e)</pre>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a>&nbsp;</span><span class="require"><a href="javascript:usdlc.edit_source({value:'require.coffee',path:'../roaster/drivers/require.coffee',category:'drivers'})">require.coffee</a> </span></div>

<h3>Module Path Conventions</h3>

<p>As with server files, <em>requires</em>&nbsp;searches well-known paths first on the target project and second on <em>roaster</em>. First it looks in <em>/client/</em>, then on the server paths, being <em>/common/, /server/ </em>and<em> /</em>.</p>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a>&nbsp;</span><span class="bootstrap"><a href="javascript:usdlc.edit_source({value:'bootstrap.coffee',path:'../roaster/client/bootstrap.coffee',category:'client'})">bootstrap.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h3>Client Server Hybrid Modules</h3>

<p>It is often clearest to implement the two sides of a client/server communication in a single file. For this reason <em>module.exports.client</em> is used if it exists - otherwise <em>module.exports</em> is used as usual.</p>

<p>In the example, uSDLC2 executes which causes the test page to load (1) which in turn creates a requires to the server to (2).</p>

<pre title="coffee" type="coffee">
# (2) This code will be executed on the server
module.exports = (exchange) -&gt;
  exchange.respond.json server: 'called'

# (1) This code will be executed on the client
module.exports.client = -&gt;
  require.json "gen/usdlc2/Roaster_Client_Support/"+
  "Package_Management/Client_Server_Hybrid_Modules",
  (error, data_from_server) -&gt;
    usdlc2.check data_from_server.server, 'called'</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span><span class="init"><a href="javascript:usdlc.edit_source({value:'init.coffee',path:'../roaster/client/bootstrap/init.coffee',category:'bootstrap'})">init.coffee</a> </span><span class="loaders"><a href="javascript:usdlc.edit_source({value:'loaders.coffee',path:'../roaster/client/bootstrap/loaders.coffee',category:'bootstrap'})">loaders.coffee</a>&nbsp;</span><span class="bootstrap"><a href="javascript:usdlc.edit_source({value:'bootstrap.coffee',path:'../roaster/client/bootstrap.coffee',category:'client'})">bootstrap.coffee</a>&nbsp;</span><span class="require"><a href="javascript:usdlc.edit_source({value:'require.coffee',path:'../roaster/drivers/require.coffee',category:'drivers'})">require.coffee</a> </span><span class="driver"><a href="javascript:usdlc.edit_source({value:'driver.coffee',path:'../roaster/server/http/driver.coffee',category:'http'})">driver.coffee</a> </span><span class="script"><a href="javascript:usdlc.edit_source({value:'script.coffee',path:'../roaster/drivers/script.coffee',category:'drivers'})">script.coffee</a> </span><span class="server"><a href="javascript:usdlc.edit_source({value:'server.coffee',path:'../roaster/drivers/server.coffee',category:'drivers'})">server.coffee</a> </span><span class="respond"><a href="javascript:usdlc.edit_source({value:'respond.coffee',path:'../roaster/server/http/respond.coffee',category:'http'})">respond.coffee</a> </span><span class="create-http-server"><a href="javascript:usdlc.edit_source({value:'create-http-server.coffee',path:'../roaster/server/boot/create-http-server.coffee',category:'boot'})">create-http-server.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee">gwt.open_page "index.html"

gwt.add -&gt;
  console.log "#2 Client/Server Hybrid Module"
  @page.test -&gt;
    a = require "gen/usdlc2/Roaster_Client_Support/"+
    "Package_Management/Client_Server_Hybrid_Modules"
    a()
</textarea></p>

<h3>Basic Loading Support</h3>

<p>Require also provides facilities to load other forms of data from the server.</p>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h4>Scripts</h4>

<p>Use <em>require</em> to load modules from the current project. For external code, <em>requires.script(url, on_loaded)</em>&nbsp;provides basic asynchronous loading of JavaScript code by injecting <em>&lt;script&gt;</em> into the head element. The script is run on the browser by adding <em>domain=text/javascript</em> to the query. Use JSON, Text or Streamed below for scripts that run on the server.</p>

<pre title="coffee" type="coffee">
if gwt?.open_page
  gwt.open_page "index.html"

  gwt.add -&gt;
    console.log "#2 require.script(url, on_loaded)"
    @page.test -&gt;
      require.script "gen/usdlc2/"+
      "Roaster_Client_Support/Package_Management/"+
      "Basic_Loading_Support/Scripts.coffee", -&gt;

usdlc2.pass('this runs on client') if usdlc2?.pass</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span><span class="client"><a href="javascript:usdlc.edit_source({value:'client.coffee',path:'../roaster/drivers/client.coffee',category:'drivers'})">client.coffee</a> </span><span class="respond"><a href="javascript:usdlc.edit_source({value:'respond.coffee',path:'../roaster/server/http/respond.coffee',category:'http'})">respond.coffee</a> </span><span class="driver"><a href="javascript:usdlc.edit_source({value:'driver.coffee',path:'../roaster/server/http/driver.coffee',category:'http'})">driver.coffee</a> </span><span class="create-http-server"><a href="javascript:usdlc.edit_source({value:'create-http-server.coffee',path:'../roaster/server/boot/create-http-server.coffee',category:'boot'})">create-http-server.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h4>CSS</h4>

<p>CSS files can be added with requires.css(url) - which in turn creates a link element in the head. If the reference is to the local server, roaster provides translations from less and stylus to CSS. More can be added using the server-side morph system.</p>

<pre title="less" type="less">
@base: #f938ab;

.box-shadow(@style, @c) when (iscolor(@c)) {
  -webkit-box-shadow: @style @c;
  box-shadow:         @style @c;
}
.box-shadow(@style, @alpha: 50%) when (isnumber(@alpha)) {
  .box-shadow(@style, rgba(0, 0, 0, @alpha));
}
.box {
  float: right;
  color: saturate(@base, 5%);
  border-color: lighten(@base, 30%);
  div { .box-shadow(0 0 5px, 30%) }
}
</pre>

<p> </p>

<pre title="coffee" type="coffee">
gwt.open_page "index.html"

gwt.add -&gt;
  console.log "#2 require.css(url)"
  @page.test -&gt;
    
    require.css "gen/usdlc2/"+
      "Roaster_Client_Support/Package_Management/"+
      "Basic_Loading_Support/CSS.less"
      
    document.body.innerHTML = "&lt;div class='box'&gt;a&lt;/div&gt;"
    div = document.getElementsByClassName('box')[0]
    # wait for css to load and take effect
    setTimeout (-&gt;
      left = div.offsetLeft
      usdlc2.test left &gt; 100, "Box is at "+left), 200</pre>

<p> </p>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span><span class="panel_stack"><a href="javascript:usdlc.edit_source({value:'panel_stack.coffee',path:'../roaster/client/integrants/panel_stack.coffee',category:'integrants'})">panel_stack.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h4>JSON</h4>

<p>Data is often transferred between client and server in JSON format.</p>

<pre title="json" type="json">
{ "server-side": true }
</pre>

<pre title="coffee" type="coffee">
gwt.open_page "index.html"

gwt.add -&gt;
  console.log "#2 require.json(url, on_loaded)"
  @page.test -&gt;
    require.json "gen/usdlc2/Roaster_Client_Support/"+
    "Package_Management/Basic_Loading_Support/JSON.json",
    (error, from_server) -&gt;
      usdlc2.test from_server["server-side"]</pre>

<p> </p>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h4>Data</h4>

<p>Sometimes it is easiest to parse proprietary formats on the client.</p>

<pre title="txt" type="txt">
Spanish rain</pre>

<pre title="coffee" type="coffee">
gwt.open_page "index.html"

gwt.add -&gt;
  console.log "#2 require.data(url, on_loaded)"
  @page.test -&gt;
    require.data "gen/usdlc2/Roaster_Client_Support/"+
    "Package_Management/Basic_Loading_Support/Data.txt",
    (error, from_server) -&gt;
      rained = from_server.indexOf("Spanish rain")
      usdlc2.test rained isnt -1</pre>

<p> </p>

<div class="metadata Ref">Ref: <span class="loaders"><a href="javascript:usdlc.edit_source({value:'loaders.coffee',path:'../roaster/client/bootstrap/loaders.coffee',category:'bootstrap'})">loaders.coffee</a> </span><span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h4>Streamed</h4>

<p>For absolute control of data from the server, use <em>require.stream(url, headers..., on_data)</em>.</p>

<pre title="coffee" type="coffee">
gwt.open_page "index.html"

gwt.add -&gt;
  console.log "#2 require.stream"
  @page.test -&gt;
    data = []
    require.stream "gen/usdlc2/Roaster_Client_Support/"+
    "Package_Management/Basic_Loading_Support/Data.txt",
    pragma: "no-cache", (error, chunk, is_complete) -&gt;
      data.push chunk
      if is_complete
        data = data.join('')
        rained = data.indexOf("Spanish rain")
        usdlc2.test rained isnt -1</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span><span class="loaders"><a href="javascript:usdlc.edit_source({value:'loaders.coffee',path:'../roaster/client/bootstrap/loaders.coffee',category:'bootstrap'})">loaders.coffee</a> </span><span class="files"><a href="javascript:usdlc.edit_source({value:'files.coffee',path:'../roaster/server/files.coffee',category:'server'})">files.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h2>MVC - Separation of Concerns</h2>

<h3>Core MVC</h3>

<p>The model is the concern of the server and is connected by the controllers using <em>require.json</em> or <em>require.data</em>. The controller provides client side computation and retrieval of model information from the server. The view is comprised of HTML and Style fragments.</p>

<p>An integrant is the client side files that make up a single entity. All files have the same name. The view has a html and style file (css, less or stylus). The controller can be any language that compiles to Javascript (js, coffee, ...). The same file can include the server code to interface to the model.</p>

<p>Integrants are associated with a host element on the page. Different parts of a page can be serviced by instances of the same or different integrants. They can also be nested. Unit testing is supported by providing a mock host element.</p>

<p>An integrant is created with <em>roaster.mvc(picture, host, on_ready)</em>. The callback will be made when the html and scripts are both loaded and ready: <em>on_ready(error, integrant)</em>.</p>

<p>While the CSS is loaded as part of the integrant, the definitions are not in a separate namespace. For this example, the outer integrant is designed to fill the entire body area.</p>

<pre title="css" type="css">
html, .content {
  min-height: 100%;
  height: 100%;
  margin: 0;
  min-width: 100%;
  width: 100%;
}
</pre>

<p>The heading is for an example of html. Often an outer integrant is empty.</p>

<pre title="html" type="html">
&lt;h1&gt;This is a Heading&lt;/h1&gt;

&lt;div class="template" name="main"&gt;&lt;/div&gt;</pre>

<p>Anything with a class of <em>template</em> is recorded in the integrant array <em>@templates</em> - both as an array and by name if it has a name element. In the example above the single template can be retrieved as <em>@templates[0]</em> or <em>@templates.main.&nbsp;</em>Once a template is captured it is removed from the DOM.</p>

<p>The controller consists if a class or prototype that:</p>

<ol>
	<li>is instantiated when&nbsp;<em>mvc</em>&nbsp;is called and the server side data loaded.</li>
	<li>is loaded with a reference to the integrant base path (type), the host and mvc.</li>
	<li>any panels or inner mvc elements are created and processed</li>
	<li><em>init(done)</em> is called for any asynchronous initialisation callback <em>done(error)</em></li>
</ol>

<pre title="coffee" type="coffee">
Integrant = require 'Integrant'

class Body extends Integrant
  init: (ready) -&gt;
    # do further initialisation requiring async access
    err = null
    ready(err)
    
module.exports = Body</pre>

<p>Integrants by default live in <em>/client/integrants</em>&nbsp;in the current or roaster project. If the name starts with a / then the path is absolute to the project and is not forced into a specific&nbsp;directory. This is useful here since the files are generated in the <em><strong>usdlc2</strong></em> document. Note that the host is a raw DOM element.</p>

<p>The picture element is just that - a concise view of what is to be created. It can contain:</p>

<ul>
	<li><strong>mvc</strong> - name/url of integrant coffee, css and html</li>
	<li><strong>template</strong> - template to use from parent mvc to wrap content (default 0)</li>
	<li><strong>host_class</strong> - defaults to first element in template or template itself if empty</li>
	<li><strong>prepare</strong> - called for each panel in the cargo as they are processed</li>
	<li><strong>require</strong> - csv string of connected modules in a dir matching integrant name. Each adds a member reference into the integrant being an instance of the class exported by the module.</li>
	<li><strong>cargo</strong> - contents for this integrant
	<ul>
		<li><strong>host_class</strong> - class used to find most for sub-mvc (defaults to target)</li>
		<li><strong>mvc</strong> - inner integrant
		<ul>
			<li>... as above</li>
		</ul>
		</li>
		<li><em><strong>name</strong></em> - name of panel to append
		<ul>
			<li><strong>style</strong> - css for this panel</li>
			<li><strong>height</strong> - of panel (any css unit of measure + %</li>
			<li><strong>content</strong> - HTML content for panel</li>
		</ul>
		</li>
	</ul>
	</li>
</ul>

<pre title="gwt.coffee" type="gwt.coffee">
gwt.open_page "test/index.html"

gwt.add "MVC", -&gt; @page.test -&gt;
  name = "/gen/usdlc2/Roaster_Client_Support/"+
         "MVC_-_Separation_of_Concerns/Core_MVC"    
  
  picture =
    mvc: name, cargo:
      main: mvc: 'panel_stack', template: 'main', cargo:
        doc:  style: "max-height": "80%", height: "50%"
        code: style:"max-height": "80%", height:"50%"
        windows: style: height: "2em"
        
  require 'mvc', (a) -&gt;
    # Outer MVC - using the html and css from above
    a.mvc picture, document.body, (err, body) -&gt;
      process.nextTick -&gt;
        windows = body.integrant.walk 'main/windows'
        top = windows.offsetTop
        gwt.test top &gt; 100, "Box is at "+top</pre>

<p>In this example we create an integrant that fills the page. Inside it has a set of three vertically aligned resizeable panels. The panel_stack code can be viewed in the links below. In practice the three panels will themselves have other integrants:</p>

<ul>
	<li><strong>main.doc</strong>: A CKEditor integrant</li>
	<li><strong>main.code</strong>: A tab integrant containing CodeMirror integrants</li>
	<li><strong>main.windows</strong>: A tab integrant linking to other windows</li>
</ul>

<div class="metadata Ref">Ref: <span class="panel_stack"><a href="javascript:usdlc.edit_source({value:'panel_stack.coffee',path:'../roaster/client/integrants/panel_stack.coffee',category:'integrants'})">panel_stack.coffee</a> </span><span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a>&nbsp;</span><span class="index"><a href="javascript:usdlc.edit_source({value:'index.html',path:'../roaster/index.html',category:'roaster'})">index.html</a> </span><span class="mvc"><a href="javascript:usdlc.edit_source({value:'mvc.coffee',path:'../roaster/client/mvc.coffee',category:'client'})">mvc.coffee</a> </span><span class="test_html"><a href="javascript:usdlc.edit_source({value:'test_html.html',path:'../roaster/test/test_html.html',category:'test'})">test_html.html</a> </span><span class="bootstrap"><a href="javascript:usdlc.edit_source({value:'bootstrap.coffee',path:'../roaster/client/bootstrap.coffee',category:'client'})">bootstrap.coffee</a> </span><span class="Integrant"><a href="javascript:usdlc.edit_source({value:'Integrant.coffee',path:'../roaster/client/Integrant.coffee',category:'client'})">Integrant.coffee</a> </span><span class="tabs"><a href="javascript:usdlc.edit_source({value:'tabs.coffee',path:'../roaster/client/integrants/html_editor/tabs.coffee',category:'html_editor'})">tabs.coffee</a> </span><span class="toolbar"><a href="javascript:usdlc.edit_source({value:'toolbar.coffee',path:'../roaster/client/integrants/html_editor/toolbar.coffee',category:'html_editor'})">toolbar.coffee</a> </span><span class="open"><a href="javascript:usdlc.edit_source({value:'open.coffee',path:'../roaster/client/integrants/html_editor/open.coffee',category:'html_editor'})">open.coffee</a> </span><span class="html_editor"><a href="javascript:usdlc.edit_source({value:'html_editor.html',path:'../roaster/client/integrants/html_editor.html',category:'integrants'})">html_editor.html</a> </span><span class="Sequential"><a href="javascript:usdlc.edit_source({value:'Sequential.js',path:'../roaster/common/Sequential.js',category:'common'})">Sequential.js</a> </span><span class="init"><a href="javascript:usdlc.edit_source({value:'init.coffee',path:'../roaster/client/bootstrap/init.coffee',category:'bootstrap'})">init.coffee</a> </span><span class="loaders"><a href="javascript:usdlc.edit_source({value:'loaders.coffee',path:'../roaster/client/bootstrap/loaders.coffee',category:'bootstrap'})">loaders.coffee</a> </span><span class="dom"><a href="javascript:usdlc.edit_source({value:'dom.coffee',path:'../roaster/client/bootstrap/dom.coffee',category:'bootstrap'})">dom.coffee</a> </span><span class="load"><a href="javascript:usdlc.edit_source({value:'load.js',path:'../roaster/boot/load.js',category:'boot'})">load.js</a> </span><span class="npm"><a href="javascript:usdlc.edit_source({value:'npm.js',path:'../roaster/server/npm.js',category:'server'})">npm.js</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h4>Integrant Support</h4>

<p>The <em>mvc</em>&nbsp;function calls back when all is ready. The host will have an integrant member pointing to the mvc functionality. The instance is also seeded with references to:</p>

<ul>
	<li><strong>type</strong>: The name of the mvc type/path from the building picture</li>
	<li><strong>host</strong>: circular reference to the DOM host containing this mvc element</li>
	<li><strong>mvc</strong>: reference to the builder for adding further inner mvcs</li>
</ul>

<div class="metadata Ref">Ref: <span class="mvc"><a href="javascript:usdlc.edit_source({value:'mvc.coffee',path:'../roaster/client/mvc.coffee',category:'client'})">mvc.coffee</a></span><span class="date"><a href="javascript:usdlc.edit_source({value:'date.coffee',path:'../roaster/common/date.coffee',category:'common'})">date.coffee</a> </span><span class="load"><a href="javascript:usdlc.edit_source({value:'load.js',path:'../roaster/boot/load.js',category:'boot'})">load.js</a> </span><span class="coffee-script"><a href="javascript:usdlc.edit_source({value:'coffee-script.coffee',path:'../roaster/client/packages/coffee-script.coffee',category:'packages'})">coffee-script.coffee</a> </span><span class="bootstrap"><a href="javascript:usdlc.edit_source({value:'bootstrap.coffee',path:'../roaster/client/bootstrap.coffee',category:'client'})">bootstrap.coffee</a> </span><span class="init"><a href="javascript:usdlc.edit_source({value:'init.coffee',path:'../roaster/client/bootstrap/init.coffee',category:'bootstrap'})">init.coffee</a> </span><span class="loaders"><a href="javascript:usdlc.edit_source({value:'loaders.coffee',path:'../roaster/client/bootstrap/loaders.coffee',category:'bootstrap'})">loaders.coffee</a> </span><span class="panel_switcher"><a href="javascript:usdlc.edit_source({value:'panel_switcher.coffee',path:'../roaster/client/integrants/panel_switcher.coffee',category:'integrants'})">panel_switcher.coffee</a> </span></div>

<h5>init (ready)</h5>

<p>Any integrant class can have an init class that is called last thing before the integrant is deemed ready. All references to inner integrants and panels from the picture have been created.</p>

<h5>require (modules, ready)</h5>

<p>Usually called in <em>init(@integrant, [ready])</em>&nbsp;to load additional integrant related modules from <em>client/integrants/<strong>&lt;&lt;module_name&gt;&gt;</strong>/</em>.&nbsp;</p>

<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;"><code>class Body<br />
&nbsp; init: (ready) -&gt;<br />
&nbsp; &nbsp; @require "moda,modb","modc", -&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;assert @mida.test == 2<br />
&nbsp;&nbsp; &nbsp; &nbsp;ready()<br />
module.exports = Body<br />
<br />
####<br />
<br />
class Moda<br />
&nbsp;&nbsp;init: (@integrant, ready) -&gt; ready()<br />
&nbsp;&nbsp;test: 2<br />
module.exports = Moda()</code></div>

<p>&nbsp;Modules have the same make-up as integrants - a class is instantiated and an optional <em>init(@integrant, ready)</em> is run. See the&nbsp;<em>tabs.coffee</em>&nbsp;link below for an example.</p>

<div class="metadata Ref">Ref: <span class="tabs"><a href="javascript:usdlc.edit_source({value:'tabs.coffee',path:'../roaster/client/integrants/html_editor/tabs.coffee',category:'html_editor'})">tabs.coffee</a> </span></div>

<h5>walk (path)</h5>

<p>Walk between mvc DOM elements. Use integrant or convenience method on the DOM element.</p>

<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;"><code>main = body.integrant.walk 'main'<br />
windows = main.walk 'windows'<br />
doc = windows.integrant.walk '../doc'<br />
code = doc.walk '/main/doc'</code></div>

<h5>walk(subelement).select</h5>

<p>Select assumes that only one of the list of appended elements can be selected at any one time. It calls <em>picture.action(element,is_selected)</em>&nbsp;on the element being deselected and again on the one being selected. The subelement can be either a name string or a reference to the element to be selected. It also calls <em>selection(item, state)</em> in the class instance to activate visual changes. See <em>panel_switcher</em> for an example.</p>

<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;"><code>tab.onclick = =&gt;&nbsp;tab.integrant.select(tab)</code></div>

<div class="metadata Ref"><br />
<span class="panel_switcher"><a href="javascript:usdlc.edit_source({value:'panel_switcher.coffee',path:'../roaster/client/integrants/panel_switcher.coffee',category:'integrants'})">panel_switcher.coffee</a> </span><span class="tab_view"><a href="javascript:usdlc.edit_source({value:'tab_view.coffee',path:'../roaster/client/integrants/tab_view.coffee',category:'integrants'})">tab_view.coffee</a></span><span class="html_editor"><a href="javascript:usdlc.edit_source({value:'html_editor.html',path:'../roaster/client/integrants/html_editor.html',category:'integrants'})">html_editor.html</a> </span><span class="Integrant"><a href="javascript:usdlc.edit_source({value:'Integrant.coffee',path:'../roaster/client/Integrant.coffee',category:'client'})">Integrant.coffee</a> </span></div>

<h3>&nbsp;Panel Stacks</h3>

<p>A panel stack is a group of empty elements stacked one on top of the other, all the width of the host element. The height of any element can be changed and the stack will adjust the height of the others to fill the host. How each panel behaves is controlled by it's style height option:</p>

<ul>
	<li><strong>no height option</strong> - This panel will be high enough to fit content. If content height changes, the panel height changes and donor panels will also change to compensate. Fit panels are optional.</li>
	<li><strong>style: height: '100%'</strong> - for donor panels. They will change height to fill the page should a fit or receiver panel change size. Their must be at least one donor panel and the sum of all the donor panels should be 100%.</li>
	<li><strong>style: height: '200px'</strong> - Receiver panels are those of fixed height. They will take space from or give space back to donor panels as they change size. Receiver panels are optional.</li>
</ul>

<pre title="coffee" type="coffee">
gwt.open_page "test/index.html"

gwt.add "Panel Stack", -&gt; @page.test -&gt;
  
  picture =
    mvc: 'panel_stack', template: 'main', cargo:
      header:  {}
      doc:     style: height: '50%'
      code:    style: height: '50%'
      windows: {}

  require 'mvc', (the) -&gt;
    the.mvc picture, document.body, (err, main) -&gt;
      process.nextTick -&gt;
        windows = main.walk 'windows'
        top = windows.offsetTop
        usdlc2.test top &gt; 100, "Box is at "+top</pre>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<div class="metadata Ref"><br />
<span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a> </span><span class="Integrant"><a href="javascript:usdlc.edit_source({value:'Integrant.coffee',path:'../roaster/client/Integrant.coffee',category:'client'})">Integrant.coffee</a> </span></div>

<h3>Panel Switcher</h3>

<p>Given a host, add a series of panels where only one will be visible at any one time. Call add() and append() for new panels and select() to choose which one is displayed.</p>

<pre title="coffee" type="coffee">
gwt.open_page "test/index.html"

gwt.add "Panel Switcher", -&gt; @page.test -&gt;
  
  picture =
    mvc: 'panel_switcher', cargo:
      one: html:'One', style:"background-color":"red"
      two: html:'Two', style:"background-color":"green"

  require 'mvc', (imports) -&gt;
    imports.mvc picture, document.body, (err, host) -&gt;
      colour = (expected_colour) -&gt;
        hidden = host.getElementsByClassName('hidden')
        return false if hidden.length isnt 1
        bg_colour = hidden[0].style["background-color"]
        return bg_colour isnt expected_colour
         
      host.walk("one").select()
      process.nextTick -&gt;
        return gwt.fail('One') if not colour "red"
        
        host.walk("two").select()
        process.nextTick -&gt;
          return gwt.fail('Two') if not colour "green"
          gwt.pass()</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a>&nbsp;</span><span class="streams"><a href="javascript:usdlc.edit_source({value:'streams.coffee',path:'../roaster/server/streams.coffee',category:'server'})">streams.coffee</a> </span><span class="respond"><a href="javascript:usdlc.edit_source({value:'respond.coffee',path:'../roaster/server/http/respond.coffee',category:'http'})">respond.coffee</a> </span><span class="line_reader"><a href="javascript:usdlc.edit_source({value:'line_reader.coffee',path:'../roaster/server/line_reader.coffee',category:'server'})">line_reader.coffee</a> </span><span class="internet"><a href="javascript:usdlc.edit_source({value:'internet.coffee',path:'../roaster/server/internet.coffee',category:'server'})">internet.coffee</a> </span><span class="server"><a href="javascript:usdlc.edit_source({value:'server.coffee',path:'../roaster/scripts/server.coffee',category:'scripts'})">server.coffee</a> </span><span class="mvc"><a href="javascript:usdlc.edit_source({value:'mvc.coffee',path:'../roaster/client/mvc.coffee',category:'client'})">mvc.coffee</a> </span><span class="panel_switcher"><a href="javascript:usdlc.edit_source({value:'panel_switcher.coffee',path:'../roaster/client/integrants/panel_switcher.coffee',category:'integrants'})">panel_switcher.coffee</a> </span><span class="panel_stack"><a href="javascript:usdlc.edit_source({value:'panel_stack.coffee',path:'../roaster/client/integrants/panel_stack.coffee',category:'integrants'})">panel_stack.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h3>Tab View</h3>

<p>Display tabs. When selected, it's action property is called. You can select() a tab programmatically.</p>

<pre title="coffee" type="coffee">
gwt.open_page "test/index.html"

gwt.add "Tab View", -&gt; @page.test -&gt;
  go = -&gt;
    require 'mvc', (imports) -&gt;
      current = ""
      act = (tab, select) -&gt;
        current = tab.picture.content if select

      # I could use select/deselect instead of action
      picture =
        mvc: 'tab_view', error: "message", cargo:
          One: action: act, nn: 1, content: 'One'
          Two: action: act, nn: 2, content: 'Two'
          Three: action: act, nn: 3, content: 'Three'
          Four: action: act, nn: 4, content: 'Four', \
                selected: true
            
      check = (expected) -&gt;
        return true if current is expected
        gwt.fail "Expected #{expected}, found #{current}"
        return false

      imports.mvc picture, document.body, (err, tabs) -&gt;
        process.nextTick -&gt;
          return if not check('Four')
          tabs.walk('Two').select()
          return if not check('Two')
          tabs.walk('Three').click()
          return if not check('Three')

          me = document.getElementsByClassName('messages')
          return gwt.fail('Messages') if me.length is 0 \
            or me[0].innerHTML isnt 'message&lt;/b&gt;'
          gwt.pass()
  setTimeout go, 4#000</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span><span class="bootstrap"><a href="javascript:usdlc.edit_source({value:'bootstrap.coffee',path:'../roaster/client/bootstrap.coffee',category:'client'})">bootstrap.coffee</a> </span><span class="tab_view"><a href="javascript:usdlc.edit_source({value:'tab_view.coffee',path:'../roaster/client/integrants/tab_view.coffee',category:'integrants'})">tab_view.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h3>HTML Editor View</h3>

<p>This integrant wraps ckeditor for convenient use.</p>

<pre title="coffee" type="coffee">
gwt.open_page "test/index.html"

gwt.add "HTML Editor View", -&gt; @page.test -&gt;
  go = -&gt;
    picture = mvc:'html_editor', options:fullPage:true

    require 'mvc', (imports) -&gt;
      imports.mvc picture, document.body, (err, ed) -&gt;
        return gwt.fail(err) if err
        process.nextTick -&gt;
  setTimeout go, 4#000</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a>&nbsp;</span><span class="html_editor"><a href="javascript:usdlc.edit_source({value:'html_editor.coffee',path:'../roaster/client/integrants/html_editor.coffee',category:'integrants'})">html_editor.coffee</a> </span><span class="toolbar"><a href="javascript:usdlc.edit_source({value:'toolbar.coffee',path:'../roaster/client/integrants/html_editor/toolbar.coffee',category:'html_editor'})">toolbar.coffee</a> </span><span class="tabs"><a href="javascript:usdlc.edit_source({value:'tabs.coffee',path:'../roaster/client/integrants/html_editor/tabs.coffee',category:'html_editor'})">tabs.coffee</a></span><span class="tab_view"><a href="javascript:usdlc.edit_source({value:'tab_view.html',path:'../roaster/client/integrants/tab_view.html',category:'integrants'})">tab_view.html</a> </span><span class="open"><a href="javascript:usdlc.edit_source({value:'open.coffee',path:'../roaster/client/integrants/html_editor/open.coffee',category:'html_editor'})">open.coffee</a>&nbsp;</span><span class="Integrant"><a href="javascript:usdlc.edit_source({value:'Integrant.coffee',path:'../roaster/client/Integrant.coffee',category:'client'})">Integrant.coffee</a> </span><span class="mvc"><a href="javascript:usdlc.edit_source({value:'mvc.coffee',path:'../roaster/client/mvc.coffee',category:'client'})">mvc.coffee</a>&nbsp;</span><span class="Sequential"><a href="javascript:usdlc.edit_source({value:'Sequential.js',path:'../roaster/common/Sequential.js',category:'common'})">Sequential.js</a> </span><span class="bootstrap"><a href="javascript:usdlc.edit_source({value:'bootstrap.coffee',path:'../roaster/client/bootstrap.coffee',category:'client'})">bootstrap.coffee</a> </span><span class="loaders"><a href="javascript:usdlc.edit_source({value:'loaders.coffee',path:'../roaster/client/bootstrap/loaders.coffee',category:'bootstrap'})">loaders.coffee</a> </span><span class="ckeditor4"><a href="javascript:usdlc.edit_source({value:'ckeditor4.coffee',path:'../roaster/client/packages/ckeditor4.coffee',category:'packages'})">ckeditor4.coffee</a> </span><span class="scheduler"><a href="javascript:usdlc.edit_source({value:'scheduler.coffee',path:'../roaster/client/packages/dhtmlx/scheduler.coffee',category:'dhtmlx'})">scheduler.coffee</a> </span><span class="panel_stack"><a href="javascript:usdlc.edit_source({value:'panel_stack.coffee',path:'../roaster/client/integrants/panel_stack.coffee',category:'integrants'})">panel_stack.coffee</a> </span><span class="panel_switcher"><a href="javascript:usdlc.edit_source({value:'panel_switcher.coffee',path:'../roaster/client/integrants/panel_switcher.coffee',category:'integrants'})">panel_switcher.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h3>Scheduler View</h3>

<p>This component wraps the GPL version of DHTMLX scheduler.</p>

<pre title="coffee" type="coffee">
gwt.open_page "test/index.html"

gwt.add "Scheduler View", -&gt; @page.test -&gt;
  go = -&gt;
    picture = mvc:'dhtmlx/scheduler', options:{}

    require 'mvc', (imports) -&gt;
      imports.mvc picture, document.body, (err, schd) -&gt;
        return gwt.fail(err) if err
        process.nextTick -&gt;
  setTimeout go, 4#000</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a> </span><span class="Play"><a href="javascript:usdlc.play()">Play</a>&nbsp;</span><span class="panel_stack"><a href="javascript:usdlc.edit_source({value:'panel_stack.coffee',path:'../roaster/client/integrants/panel_stack.coffee',category:'integrants'})">panel_stack.coffee</a> </span><span class="scheduler"><a href="javascript:usdlc.edit_source({value:'scheduler.less',path:'../roaster/client/integrants/dhtmlx/scheduler.less',category:'dhtmlx'})">scheduler.less</a> </span><span class="loaders"><a href="javascript:usdlc.edit_source({value:'loaders.coffee',path:'../roaster/client/bootstrap/loaders.coffee',category:'bootstrap'})">loaders.coffee</a> </span><span class="dependency"><a href="javascript:usdlc.edit_source({value:'dependency.coffee',path:'../roaster/client/dependency.coffee',category:'client'})">dependency.coffee</a> </span><span class="ckeditor4"><a href="javascript:usdlc.edit_source({value:'ckeditor4.coffee',path:'../roaster/client/packages/ckeditor4.coffee',category:'packages'})">ckeditor4.coffee</a> </span><span class="scheduler_mobile"><a href="javascript:usdlc.edit_source({value:'scheduler_mobile.coffee',path:'../roaster/client/packages/dhtmlx/scheduler_mobile.coffee',category:'dhtmlx'})">scheduler_mobile.coffee</a> </span><span class="packages"><a href="javascript:usdlc.edit_source({value:'packages.coffee',path:'../roaster/server/packages.coffee',category:'server'})">packages.coffee</a> </span><span class="internet"><a href="javascript:usdlc.edit_source({value:'internet.coffee',path:'../roaster/server/internet.coffee',category:'server'})">internet.coffee</a> </span><span class="update-node"><a href="javascript:usdlc.edit_source({value:'update-node.sh',path:'../roaster/install/update-node.sh',category:'install'})">update-node.sh</a> </span><span class="respond"><a href="javascript:usdlc.edit_source({value:'respond.coffee',path:'../roaster/server/http/respond.coffee',category:'http'})">respond.coffee</a> </span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h2>Notes</h2>
</body>
</html>
